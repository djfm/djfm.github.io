<!DOCTYPE html>
<html>
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M3CJRL4');</script>
      <!-- End Google Tag Manager -->
    <title>
      djfm
    </title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
      body {
        margin: 0;
      }
      #overlay {
        display: none;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 0;
        background: linear-gradient(
          rgb(13,17,23),
          rgba(13,17,23,.9) 50%,
          rgba(13,17,23,.4) 80%,
          rgba(13,17,23,.1)
        );
      }
    </style>
    <style data-styled="true" data-styled-version="5.3.0">.goOvgH{font-family:monospace;font-size:1.2rem;line-height:1.5;word-break:normal;overflow-wrap:break-word;}/*!sc*/
.goOvgH a{-webkit-text-decoration:none;text-decoration:none;color:#0080ff;}/*!sc*/
.goOvgH a:visited{color:#0080ff;}/*!sc*/
data-styled.g1[id="sc-bdnxRM"]{content:"goOvgH,"}/*!sc*/
.jLpBos{font-size:0.7em;margin:15px 0 15px 30px;padding:5px 15px 5px 15px;2px 2px 3px 1px #795548;}/*!sc*/
.jLpBos > *:first-child{margin-top:0;}/*!sc*/
.jLpBos > *:last-child{margin-bottom:0;}/*!sc*/
data-styled.g2[id="sc-gtsrHT"]{content:"jLpBos,"}/*!sc*/
.gllErl a{-webkit-text-decoration:none;text-decoration:none;color:#ffa657;}/*!sc*/
.gllErl a:visited{color:#ffa657;}/*!sc*/
.gllErl a.active{font-weight:bold;color:#a5d2ff;}/*!sc*/
.gllErl a.active::before{content:"✴ ";}/*!sc*/
data-styled.g3[id="sc-dlnjwi"]{content:"gllErl,"}/*!sc*/
@media(min-width:800px){.bsBukI{max-width:800px;margin:0 auto;}}/*!sc*/
@media(max-width:799px){.bsBukI{max-width:calc(100vw - 20px);margin:0 auto;}}/*!sc*/
data-styled.g4[id="sc-hKFxyN"]{content:"bsBukI,"}/*!sc*/
.bQTLOG{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding:0 10px 0 10px;}/*!sc*/
.bQTLOG li{list-style:none;}/*!sc*/
.bQTLOG li:not(:first-child){margin-left:1.2em;}/*!sc*/
data-styled.g5[id="sc-eCApnc"]{content:"bQTLOG,"}/*!sc*/
.IWhPz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding:0 10px 0 10px;}/*!sc*/
.IWhPz li{list-style:none;}/*!sc*/
.IWhPz li:not(:first-child){margin-top:1.2em;}/*!sc*/
data-styled.g6[id="sc-jSFjdj"]{content:"IWhPz,"}/*!sc*/
.EqMWR{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
.EqMWR > *:first-child ul{background-color:#0d1117;padding:5px;}/*!sc*/
@media (max-width:1199px){.EqMWR{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}/*!sc*/
@media (min-width:1200px){.EqMWR{-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;}.EqMWR > *:first-child{-webkit-flex-basis:250px;-ms-flex-preferred-size:250px;flex-basis:250px;}.EqMWR > *:first-child ul{position:fixed;width:250px;}.EqMWR > *:last-child{-webkit-flex:1;-ms-flex:1;flex:1;}}/*!sc*/
data-styled.g8[id="sc-iCoGMd"]{content:"EqMWR,"}/*!sc*/
.boWyKY{margin-top:1.7em;margin-bottom:1.7em;}/*!sc*/
data-styled.g9[id="sc-fujyAs"]{content:"boWyKY,"}/*!sc*/
.hdbXZh{padding:5px;}/*!sc*/
data-styled.g10[id="sc-pNWdM"]{content:"hdbXZh,"}/*!sc*/
.bXlUwS > h1{margin-top:10px;margin-bottom:10px;text-align:center;}/*!sc*/
data-styled.g11[id="sc-jrsJWt"]{content:"bXlUwS,"}/*!sc*/
.gaHMwM{white-space:nowrap;}/*!sc*/
data-styled.g13[id="sc-iqAclL"]{content:"gaHMwM,"}/*!sc*/
.jZMlIc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:20px;}/*!sc*/
.jZMlIc > figure{max-width:100%;margin-left:0;margin-right:0;margin-bottom:0;}/*!sc*/
.jZMlIc > figure > figcaption{max-width:100%;margin:0 auto;}/*!sc*/
.jZMlIc > figure pre{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;max-width:100%;overflow:auto;}/*!sc*/
.jZMlIc > figure pre code{padding:2px;}/*!sc*/
data-styled.g15[id="sc-dIsUp"]{content:"jZMlIc,"}/*!sc*/
.jAfpoX{display:none;}/*!sc*/
@media (max-width:1199px){.jAfpoX{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:5px;height:50px;position:relative;}.jAfpoX .closed-menu{position:absolute;top:0;right:0;padding-top:5px;padding-right:5px;}.jAfpoX .open-menu{position:fixed;top:0;left:0;width:100%;background-color:#0d1117;z-index:1;}.jAfpoX .open-menu input{position:fixed;top:8px;right:0;}}/*!sc*/
data-styled.g16[id="sc-bqGGPW"]{content:"jAfpoX,"}/*!sc*/
.bWFMjp{display:none;}/*!sc*/
@media (min-width:1200px){.bWFMjp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;margin-top:0;padding:5px;background-color:#0d1117;}}/*!sc*/
data-styled.g17[id="sc-ksluID"]{content:"bWFMjp,"}/*!sc*/
.bKjGxz{margin-top:50px;position:relative;left:0;right:0;bottom:5px;}/*!sc*/
.bKjGxz > div{display:inline-block;text-align:center;margin-left:5px;}/*!sc*/
data-styled.g18[id="sc-hBMUJo"]{content:"bKjGxz,"}/*!sc*/
</style>
    <link rel="preload" href="/assets/hljs/styles/github-dark.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/assets/hljs/styles/github-dark.min.css"></noscript>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M3CJRL4"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    <div id="overlay">&nbsp;</div>
    <div id="root"><div><div class="sc-bdnxRM goOvgH"><div><div class="sc-bqGGPW jAfpoX"><div class="closed-menu"><input type="image" alt="open menu" src="/img/menu-closed.png" width="48px"/></div></div><nav class="sc-dlnjwi gllErl"><ul class="sc-eCApnc sc-ksluID bQTLOG bWFMjp"><li><a href="/">Qu&#x27;est-ce que ce site ?</a></li><li><a aria-current="page" class="active" href="/typescript">TypeScript, c&#x27;est chouette !</a></li></ul></nav></div><div class="sc-pNWdM hdbXZh"><main class="sc-jrsJWt bXlUwS"><h1 class="sc-fujyAs boWyKY">Des choses autour de TypeScript<br/>ma nouvelle passion</h1><div class="sc-iCoGMd EqMWR"><div class="sc-hKFxyN bsBukI"><nav class="sc-dlnjwi gllErl"><ul class="sc-jSFjdj IWhPz"><li><a href="/typescript/">TypeScript en bref</a></li><li><a aria-current="page" class="active" href="/typescript/vite-mettre-en-place-environnement-typescript">Rapidement configurer un nouveau projet TypeScript</a></li><li><a href="/typescript/types-vs-interfaces">Types vs. Interfaces</a></li><li><a href="/typescript/type-narrowing">Le «narrowing» ou la découverte incrémentale des types</a></li></ul></nav></div><div class="sc-hKFxyN bsBukI"><article class="sc-kEqXSa drBNvn"><h1 id="scroll-transition-anchor" class="sc-fujyAs boWyKY">Comment configurer très rapidement son environnement de travail pour TypeScript</h1><p>En cours de rédaction :)</p><p>Beaucoup de gens utilisent des outils dits de <i>scaffolding</i>  (littéralement &quot;construction d&#x27;échafaudage&quot;) pour créer la myriade de fichiers de configuration nécessaire à un projet web digne de ce nom de nos jours.</p><p>D&#x27;autres se créent un ou plusieurs dépôts dits &quot;de <i>boilerplate</i>&quot;  qu&#x27;ils clonent à chaque nouveau projet.</p><section><p>Ces approches sont pratiques, mais je ne les aime pas beaucoup :</p><ul><li>avec le <i>scaffolding</i> je ne comprends pas ce que je fais, je manque de flexibilité, j&#x27;ai du mal à débugger quand quelque chose ne fonctionne pas correctement</li><li>avec les <i>boilerplate</i> je me coupe de l&#x27;avancée de l&#x27;état de l&#x27;art et m&#x27;enferme dans des habitudes</li></ul></section><p>Ma stratégie personnelle est de <strong>tout reconstruire à partir de zéro à chaque fois</strong>, tout en m&#x27;inspirant de sources que je connais bien pour accélérer la manoeuvre.</p><p>Ces sources peuvent être certains de mes projets, de la documentation officielle bien réputée...</p><p>Plus on fait ça, plus on va vite et plus on en apprend sur ses outils. Je perds sans doute une dizaine de minute à chaque projet par rapport à quelqu&#x27;un qui va utiliser un outil magique, mais que sont dix minutes sur la vie d&#x27;un projet, surtoût quand on prend en compte le bénéfice de l&#x27;apprentissage&#x27;?</p><p>Pour rédiger cette page, je me suis installé un <i>Ubuntu 20.04</i> tout frais dans une VM, histoire de <strong>vraiment prendre les choses depuis le début</strong>.</p><p>Je vais tâcher de documenter la manière la plus efficace, selon moi, de créer un projet en TypeScript avec le linting et tout ce qui va bien en partant d&#x27;une installation vierge d&#x27;<i>Ubuntu</i>.</p><p>Nous sommes le 29 juin 2021, cette documentation sera sans doute périmée demain. Allons-y...</p><section><h1>On commence par installer <i>Node.js</i> et <i>yarn</i></h1><p>J&#x27;utilise le plus souvent possible <i>snap</i> pour installer des choses, on a des paquets plus récents, mis à jour automatiquement, et, pour certains, avec un système d&#x27;isolation de l&#x27;environnement d&#x27;exécution du programme qui fait qu&#x27;on augmente la sécurité de son système.</p><p>Bon, la nature de <i>node</i> fait qu&#x27;on n&#x27;a pas de sécurité supplémentaire grâce à <i>snap</i> par rapport à <i>apt</i> mais c&#x27;est pas grave.<br/>C&#x27;est pour ça qu&#x27;on met <span class="sc-iqAclL gaHMwM"><i>--classic</i></span> dans la commande qui suit :</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>Installation de Node.js</figcaption><pre><code class="hljs no-highlight">sudo snap install node --channel 16/stable --classic</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><section><p>Ensuite, j&#x27;installe <i>yarn</i> comme gestionnaire de paquets plutôt que le traditionnel <i>npm</i>, parce que <i>yarn</i> apporte plein d&#x27;avantages comme :</p><ul><li>une installation beaucoup plus rapide des dépendances</li><li>un vérrouillage plus strict des versions des dépendances</li><li>une meilleure reproductibilité des installations grâce au fait que l&#x27;on versionne ses dépendances dans son projet</li></ul>La liste est longue, ce n&#x27;est pas le sujet ici. Installons :<div class="sc-dIsUp jZMlIc"><figure><figcaption>Installation de yarn</figcaption><pre><code class="hljs no-highlight">sudo npm install -g yarn</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>À l&#x27;heure où j&#x27;écris ces lignes, c&#x27;est la version 1.x de <i>yarn</i> est installée. On verra plus tard qu&#x27;on utilisera en fait la v2 pour notre projet.</p></section></section><section><h1>Puis, on se crée un projet</h1><p>On se met dans le dossier qu&#x27;on veut  et on lance <code>yarn init</code> :</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>Création du dossier</figcaption><pre><code class="hljs no-highlight">mkdir ts-experiments
<span class="hljs-built_in">cd</span> ts-experiments
yarn init</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>Là, il n&#x27;y à qu&#x27;a répondre aux questions. Pour l&#x27;<i>entry point</i> on peut mettre <i>index.ts</i> à la place du <i>index.js</i> suggéré.</p><p>Ça nous crée un fichier <i>package.json</i> tout comme l&#x27;aurait fait npm.<br/>Le mien ressemble à ça :</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>package.json</figcaption><pre><code class="hljs no-highlight"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ts-experiments&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;un projet de test&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;index.ts&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;author&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;djfm&lt;fm.de.jouvencel@gmail.com&gt;&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;license&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;MIT&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;private&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span>
<span class="hljs-punctuation">}</span></code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>Maintenant qu&#x27;on a un <i>package</i> défini, on peut mettre à jour <i>yarn</i> :</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>Mise à jour de yarn vers la v2</figcaption><pre><code class="hljs no-highlight">yarn <span class="hljs-built_in">set</span> version berry
yarn --version <span class="hljs-comment"># 2.4.2 dans mon cas</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;nodeLinker: node-modules&quot;</span> &gt;&gt; .yarnrc.yml</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>Le <code>echo &quot;nodeLinker: node-modules&quot; &gt;&gt; .yarnrc.yml</code> est important, cela dit à <i>yarn</i> d&#x27;utiliser un traditionnel dossier <i>node_modules</i> au lieu de sa nouvelle architecture dénommée <i>Plug&#x27;n&#x27;Play</i>.</p><p><i>Plug&#x27;n&#x27;Play</i> c&#x27;est très bien sur le papier, mais ça fonctionne encore un peu mal avec un certain nombre d&#x27;outils, donc pour le moment je ne l&#x27;utilise pas.</p></section><section><h1>Immédiatement après, on s&#x27;occupe du linter</h1><p>J&#x27;installe toujours en premier le linter, on va prendre <i>eslint</i> comme pour le JavaScript. On le configurera juste un peu différemment.</p><p>Au plus tôt on lint, au plus tôt on évite d&#x27;être con.</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>Installation du linter</figcaption><pre><code class="hljs no-highlight">yarn add -D eslint

<span class="hljs-comment"># notez que contrairement à npm,</span>
<span class="hljs-comment"># avec yarn pas besoin de rajouter &quot;run&quot;</span>
<span class="hljs-comment"># pour lui demander de lancer un binaire qu&#x27;il</span>
<span class="hljs-comment"># a installé</span>
yarn eslint --init</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>On répond aux questions :<br/><br/><dt>How would you like to use ESLint?</dt><dd>To check syntax, find problems, and enforce code style</dd><dt>What type of modules does your project use?</dt><dd>JavaScript modules (import/export)</dd><dt>Which framework does your project use?</dt><dd>None of these</dd><dt>Does your project use TypeScript?</dt><dd>Yes</dd><dt>Where does your code run?</dt><dd>Browser, Node</dd><dt>How would you like to define a style for your project?</dt><dd>Use a popular style guide</dd><dt>Which style guide do you want to follow?</dt><dd>Airbnb: https://github.com/airbnb/javascript</dd><dt>What format do you want your config file to be in?</dt><dd>JSON</dd></p><aside class="sc-gtsrHT jLpBos"><p>De façon générale, quand j&#x27;ai le choix du <strong>type de fichier</strong> pour un fichier de <strong>configuration</strong>, <strong>je choisis <i>JSON</i></strong> :<br/>Ça évite des problèmes de chargement. Par exemple si on veut utiliser les modules <i>ESM</i>, i.e. les modules natifs avec <i>import</i> et<i>export</i>, on doit mettre <code>type: &quot;module&quot;</code> dans son <i>package.json</i> du coup <i>eslint</i> va se plaindre si on ne fait pas un <i>export default</i> de sa configuration, mais paradoxalement lui-même ne gère pas les modules natifs et échouera à charger sa propre configuration.<br/>Même genre de galère avec les configs en <i>TypeScript</i> et en <i>JavaScript</i>.<br/>Le <i>JSON</i> c&#x27;est interopérable, ça évite bien des ennuis.</p></aside><p>Là, ça va nous proposer d&#x27;installer les dépendances qui vont bien, mais il va les installer avec <i>npm</i> et ce n&#x27;est pas ce qu&#x27;on veut, donc on copie la liste des dépendances et on répond <i>No</i>.</p><p>On peut maintenant installer les dépendances qu&#x27;on a copiées :</p><div class="sc-dIsUp jZMlIc"><figure><figcaption>Installation des dépendances d&#x27;eslint</figcaption><pre><code class="hljs no-highlight">yarn add -D @typescript-eslint/eslint-plugin@latest \
eslint-config-airbnb-base@latest @typescript-eslint/parser@latest</code></pre></figure><label><div style="text-align:center;font-family:monospace;font-size:1rem">Zoom:</div><input type="range" min="10" max="170" value="100"/></label></div><p>Et je continuerai plus tard, là je vais me coucher.</p></section></article></div></div></main></div></div><div class="sc-hBMUJo bKjGxz"><div>© François-Marie de Jouvencel<br/><a href="mailto:fm.de.jouvencel@gmail.com">fm.de.jouvencel@gmail.com</a></div></div></div></div>
    <script src="/assets/hljs/highlight.min.js"></script>
    <script src="/bundle.js"></script>
  </body>
</html>
