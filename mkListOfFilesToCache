#!/usr/bin/env bash

nameFilter=(
  grep -v
  -e '/filesToCache\.json$'
  -e '/updatedFiles\.json$'
  -e '/CNAME$'
  -e '/style\.js.*$'
  -e '/worker\..*$'
)

filterAndFormat () {
  "${nameFilter[@]}" | \
  sed -e "s/^docs//" | \
  awk -v q='"' '{ print "  " q $0 q "," }' | \
  sed -e '$ s/,$//'
}

allFilesPath="./docs/filesToCache.json"
echo "[" > $allFilesPath
find docs -type f | \
filterAndFormat \
>> $allFilesPath
echo "]" >> $allFilesPath

changedSinceLastCommit=\
'git diff --name-only --diff-filter=ACMR HEAD -- docs'

updatedFilesPath="./docs/updatedFiles.json"
echo "[" > $updatedFilesPath
$changedSinceLastCommit | \
filterAndFormat \
>> $updatedFilesPath
echo "]" >> $updatedFilesPath
